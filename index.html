<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claymore by PD</title>
    <!-- Use Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0fdfa; /* A light teal background */
        }

        /* Style for the active navigation link */
        .nav-link.active {
            font-weight: bold;
            color: #0f766e; /* Darker teal for active link */
            border-bottom: 2px solid #0f766e;
        }

        .quantity-control button {
            @apply bg-gray-200 text-gray-800 font-bold w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200;
        }

        .quantity-control button:hover {
            @apply bg-gray-300;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header and Navigation -->
    <header class="bg-white shadow-md p-4">
        <nav class="container mx-auto flex justify-between items-center">
            <a href="#" onclick="showPage('products-page')" class="text-2xl font-bold text-gray-900">Claymore by PD</a>
            <div class="space-x-4 flex items-center">
                <a href="#" onclick="showPage('products-page')" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-200" data-lang-key="navProducts">Products</a>
                <a href="#" onclick="showPage('about-us-page')" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-200" data-lang-key="navAbout">About Us</a>
                <a href="#" onclick="showPage('contact-us-page')" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-200" data-lang-key="navContact">Contact Us</a>
                <!-- Cart Icon with Item Count -->
                <a href="#" onclick="showPage('cart-page')" class="relative nav-link text-gray-600 hover:text-gray-900 transition-colors duration-200 ml-4">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13-.3 8.3m0 0a2 2 0 110-4 2 2 0 010 4zm16 0a2 2 0 110-4 2 2 0 010 4z"></path></svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center p-1">0</span>
                </a>
                <!-- Language Dropdown -->
                <select id="language-selector" class="bg-gray-100 rounded-lg py-1 px-2 text-sm">
                    <option value="en">EN</option>
                    <option value="sv">SV</option>
                </select>
            </div>
        </nav>
    </header>

    <!-- Main Content Area with Pages -->
    <main class="flex-grow flex items-start justify-center p-8">
        
        <!-- Products Page Section -->
        <section id="products-page" class="w-full max-w-5xl">
            <div class="bg-white rounded-lg shadow-xl p-8 max-w-3xl mx-auto mb-8">
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-gray-800 mb-4" data-lang-key="welcomeTitle">Handmade with Love 仇벒잺</h1>
                    <p class="text-gray-600 text-lg mb-6 leading-relaxed" data-lang-key="welcomeText">
                        Explore our latest collection of products. Each item is available for immediate purchase through our secure checkout.
                    </p>
                </div>
                <!-- Banner image with data attribute for dynamic text -->
                <img id="banner-image" src="https://placehold.co/800x450/e0f2f7/0e7490" alt="Autumn collections - 2025" class="w-full rounded-lg shadow-md mb-8" data-lang-key="bannerText">
            </div>

            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4" data-lang-key="productsTitle">Our Product Collection</h2>
                <p class="text-gray-600 leading-relaxed mb-6" data-lang-key="productsText">
                    A collection of our favorite products. In a real-world scenario, you would upload these images to a folder in your GitHub repository and link to them here.
                </p>
                <!-- Product groups will be dynamically generated here -->
                <div id="product-groups"></div>
            </div>
        </section>

        <!-- About Us Page Section -->
        <section id="about-us-page" class="w-full max-w-5xl hidden">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4" data-lang-key="aboutTitle">About Our Company</h2>
                <p class="text-gray-600 leading-relaxed mb-4" data-lang-key="aboutParagraph1">
                    Founded in 2023, Claymore by PD is a leading provider of innovative solutions for modern consumers. Our mission is to deliver high-quality products and seamless experiences that empower our customers to live smarter, more connected lives. We believe in transparency, integrity, and putting our users first.
                </p>
                <p class="text-gray-600 leading-relaxed" data-lang-key="aboutParagraph2">
                    Our team of passionate experts works tirelessly to bring you the best products on the market, from the latest tech gadgets to everyday essentials. We are committed to sustainability and ethical practices, ensuring that every product you buy from us is one you can feel good about.
                </p>
            </div>
        </section>

        <!-- Contact Us Page Section -->
        <section id="contact-us-page" class="w-full max-w-md hidden">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4" data-lang-key="contactTitle">Get in Touch</h2>
                <form>
                    <div class="mb-4">
                        <label for="name" class="block text-gray-700 font-semibold mb-2" data-lang-key="contactNameLabel">Your Name</label>
                        <input type="text" id="name" name="name" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500">
                    </div>
                    <div class="mb-4">
                        <label for="email" class="block text-gray-700 font-semibold mb-2" data-lang-key="contactEmailLabel">Your Email</label>
                        <input type="email" id="email" name="email" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500">
                    </div>
                    <div class="mb-4">
                        <label for="message" class="block text-gray-700 font-semibold mb-2" data-lang-key="contactMessageLabel">Your Message</label>
                        <textarea id="message" name="message" rows="4" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="feedback" class="block text-gray-700 font-semibold mb-2" data-lang-key="contactFeedbackLabel">Your Feedback</label>
                        <textarea id="feedback" name="feedback" rows="4" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200" data-lang-key="contactSubmitBtn">
                        Send Message
                    </button>
                </form>
            </div>
        </section>

        <!-- Cart Page Section -->
        <section id="cart-page" class="w-full max-w-3xl hidden">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6" data-lang-key="cartTitle">Your Shopping Cart</h2>
                <div id="cart-items" class="space-y-4">
                    <!-- Cart items will be rendered here dynamically -->
                    <p class="text-gray-500" id="empty-cart-message" data-lang-key="emptyCartMessage">Your cart is empty. Add some products to get started!</p>
                </div>
                <!-- Total amount line, now visually distinct -->
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <div class="flex justify-between items-center py-4 px-6 bg-teal-50 rounded-lg">
                        <span class="text-lg font-bold text-teal-800" data-lang-key="cartTotalLabel">Total:</span>
                        <span class="text-2xl font-bold text-teal-800"><span id="cart-total">0</span> SEK</span>
                    </div>
                </div>
                <div class="flex justify-end items-center space-x-4 mt-6">
                    <button id="clear-cart-button" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-colors duration-200" data-lang-key="clearCartBtn">
                        Clear Cart
                    </button>
                    <!-- This button now navigates to the shipping page -->
                    <button id="checkout-button" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200" data-lang-key="checkoutBtn">
                        Checkout
                    </button>
                </div>
            </div>
        </section>

        <!-- Shipping Page Section (NEW) -->
        <section id="shipping-page" class="w-full max-w-md hidden">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4" data-lang-key="shippingTitle">Shipping Information</h2>
                <form id="shipping-form">
                    <div class="mb-4">
                        <label for="fullName" class="block text-gray-700 font-semibold mb-2" data-lang-key="shippingNameLabel">Full Name</label>
                        <input type="text" id="fullName" name="fullName" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="emailAddress" class="block text-gray-700 font-semibold mb-2" data-lang-key="shippingEmailLabel">Email Address</label>
                        <input type="email" id="emailAddress" name="emailAddress" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="address" class="block text-gray-700 font-semibold mb-2" data-lang-key="shippingAddressLabel">Address</label>
                        <input type="text" id="address" name="address" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="city" class="block text-gray-700 font-semibold mb-2" data-lang-key="shippingCityLabel">City</label>
                        <input type="text" id="city" name="city" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="zipCode" class="block text-gray-700 font-semibold mb-2" data-lang-key="shippingZipLabel">Zip Code</label>
                        <input type="text" id="zipCode" name="zipCode" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <div class="mb-6">
                        <label for="country" class="block text-gray-700 font-semibold mb-2" data-lang-key="shippingCountryLabel">Country</label>
                        <input type="text" id="country" name="country" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <button type="submit" id="continue-button" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200" data-lang-key="continueBtn">
                        Continue to Payment
                    </button>
                </form>
            </div>
        </section>

        <!-- Review Page Section (NEW) -->
        <section id="review-page" class="w-full max-w-3xl hidden">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4" data-lang-key="reviewTitle">Review Your Order</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Order Summary -->
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-4" data-lang-key="reviewOrderSummary">Order Summary</h3>
                        <div id="review-cart-items" class="space-y-4">
                            <!-- Review items will be rendered here -->
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200 flex justify-between items-center">
                            <span class="text-lg font-bold text-gray-800" data-lang-key="reviewTotalLabel">Total:</span>
                            <span class="text-2xl font-bold text-teal-600"><span id="review-total">0</span> SEK</span>
                        </div>
                    </div>
                    <!-- Shipping Details -->
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-4" data-lang-key="reviewShippingInfo">Shipping Information</h3>
                        <div id="review-shipping-details" class="space-y-2 text-gray-600">
                            <!-- Shipping details will be rendered here -->
                        </div>
                        <button id="edit-shipping-button" class="mt-4 text-sm text-teal-600 hover:underline" data-lang-key="editShippingBtn">Edit</button>
                    </div>
                </div>
                <div class="mt-8 flex justify-end items-center">
                    <button id="pay-button" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200" data-lang-key="payNowBtn">
                        Pay Now
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Payment Status Modal -->
    <div id="paymentModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4 text-center overflow-y-auto max-h-[80vh]">
            <h2 id="modalTitle" class="text-2xl font-bold text-gray-800 mb-4"></h2>
            <p id="modalMessage" class="text-gray-600 mb-6"></p>
            <button id="closeModalButton" class="flex-shrink-0 bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200" data-lang-key="closeBtn">
                Close
            </button>
        </div>
    </div>

    <script>
        // In-memory data storage
        let cart = [];
        let shippingInfo = {};

        // Object for translations
        const translations = {
            en: {
                navProducts: 'Products',
                navAbout: 'About Us',
                navContact: 'Contact Us',
                welcomeTitle: 'Handmade with Love 仇벒잺',
                welcomeText: 'Explore our latest collection of products. Each item is available for immediate purchase through our secure checkout.',
                bannerText: 'Autumn Collections - 2025',
                autumnMotto: 'Embrace the season with our new autumn designs.',
                autumnCollection: 'Autumn Collection - H칬stkollektion',
                productsTitle: 'Our Product Collection',
                productsText: 'A collection of our favorite products. In a real-world scenario, you would upload these images to a folder in your GitHub repository and link to them here.',
                addToCartBtn: 'Add to Cart',
                aboutTitle: 'About Our Company',
                aboutParagraph1: 'Founded in 2023, Claymore by PD is a leading provider of innovative solutions for modern consumers. Our mission is to deliver high-quality products and seamless experiences that empower our customers to live smarter, more connected lives. We believe in transparency, integrity, and putting our users first.',
                aboutParagraph2: 'Our team of passionate experts works tirelessly to bring you the best products on the market, from the latest tech gadgets to everyday essentials. We are committed to sustainability and ethical practices, ensuring that every product you buy from us is one you can feel good about.',
                contactTitle: 'Get in Touch',
                contactNameLabel: 'Your Name',
                contactEmailLabel: 'Your Email',
                contactMessageLabel: 'Your Message',
                contactFeedbackLabel: 'Your Feedback',
                contactSubmitBtn: 'Send Message',
                cartTitle: 'Your Shopping Cart',
                emptyCartMessage: 'Your cart is empty. Add some products to get started!',
                cartTotalLabel: 'Total:',
                clearCartBtn: 'Clear Cart',
                checkoutBtn: 'Checkout',
                shippingTitle: 'Shipping Information',
                shippingNameLabel: 'Full Name',
                shippingEmailLabel: 'Email Address',
                shippingAddressLabel: 'Address',
                shippingCityLabel: 'City',
                shippingZipLabel: 'Zip Code',
                shippingCountryLabel: 'Country',
                continueBtn: 'Continue to Payment',
                reviewTitle: 'Review Your Order',
                reviewOrderSummary: 'Order Summary',
                reviewShippingInfo: 'Shipping Information',
                reviewTotalLabel: 'Total:',
                editShippingBtn: 'Edit',
                payNowBtn: 'Pay Now',
                modalProductAddedTitle: 'Product Added!',
                modalProductAddedMessage: (productName) => `"${productName}" has been added to your cart.`,
                modalCannotCheckoutTitle: 'Cannot Checkout',
                modalCannotCheckoutMessage: 'Your cart is empty. Please add items to checkout.',
                modalPaymentSuccessTitle: 'Payment Successful!',
                modalPaymentSuccessMessage: (confirmationCode, email) => `<p class="mb-4">Thank you for your order! Your payment was successful.</p><p class="mb-4">Your confirmation code is: <span class="font-bold text-teal-600">${confirmationCode}</span></p><p>A confirmation email has been sent to ${email}.</p>`,
                modalPaymentFailedTitle: 'Payment Failed',
                modalPaymentFailedMessage: (email) => `<p class="mb-4">Unfortunately, your payment could not be processed.</p><p>An email with further instructions has been sent to ${email}. Please try again or contact support.</p>`,
                modalCartClearedTitle: 'Cart Cleared',
                modalCartClearedMessage: 'Your shopping cart has been emptied.',
                processingBtn: 'Processing...',
                buyNowBtn: 'Pay Now',
                removeItemBtn: 'Remove',
                // Category translations
                'nature-inspired-category': '游 Nature-Inspired',
                'autumn-abstracts-category': '游꼐 Autumn Abstracts',
                'bold-artistic-category': '仇벒잺 Bold & Artistic',
                'shimmer-flow-category': '游꼑 Shimmer & Fl칬de',
                closeBtn: 'Close'
            },
            sv: {
                navProducts: 'Produkter',
                navAbout: 'Om Oss',
                navContact: 'Kontakta Oss',
                welcomeTitle: 'Handgjort med K칛rlek 仇벒잺',
                welcomeText: 'Utforska v친r senaste kollektion av produkter. Varje artikel 칛r tillg칛nglig f칬r omedelbart k칬p via v친r s칛kra kassa.',
                bannerText: 'H칬stkollektioner - 2025',
                autumnMotto: 'Omfamna s칛songen med v친ra nya h칬stdesigner.',
                autumnCollection: 'H칬stkollektion - Autumn Collection',
                productsTitle: 'V친r produktkollektion',
                productsText: 'En samling av v친ra favoritprodukter. I ett verkligt scenario skulle du ladda upp dessa bilder till en mapp i ditt GitHub-arkiv och l칛nka till dem h칛r.',
                addToCartBtn: 'L칛gg i varukorg',
                aboutTitle: 'Om V친rt F칬retag',
                aboutParagraph1: 'Claymore by PD, grundat 2023, 칛r en ledande leverant칬r av innovativa l칬sningar f칬r moderna konsumenter. V친r mission 칛r att leverera h칬gkvalitativa produkter och s칬ml칬sa upplevelser som ger v친ra kunder m칬jlighet att leva smartare och mer uppkopplade liv. Vi tror p친 transparens, integritet och att s칛tta v친ra anv칛ndare f칬rst.',
                aboutParagraph2: 'V친rt team av passionerade experter arbetar outtr칬ttligt f칬r att ge dig de b칛sta produkterna p친 marknaden, fr친n de senaste tekniska prylarna till vardagliga n칬dv칛ndigheter. Vi 칛r engagerade i h친llbarhet och etiska metoder, vilket s칛kerst칛ller att varje produkt du k칬per fr친n oss 칛r en du kan k칛nna dig n칬jd med.',
                contactTitle: 'Kontakta Oss',
                contactNameLabel: 'Ditt Namn',
                contactEmailLabel: 'Din E-post',
                contactMessageLabel: 'Ditt Meddelande',
                contactFeedbackLabel: 'Din Feedback',
                contactSubmitBtn: 'Skicka Meddelande',
                cartTitle: 'Din Varukorg',
                emptyCartMessage: 'Din varukorg 칛r tom. L칛gg till n친gra produkter f칬r att komma ig친ng!',
                cartTotalLabel: 'Totalt:',
                clearCartBtn: 'T칬m varukorg',
                checkoutBtn: 'G친 till kassan',
                shippingTitle: 'Leveransinformation',
                shippingNameLabel: 'Fullst칛ndigt namn',
                shippingEmailLabel: 'E-postadress',
                shippingAddressLabel: 'Adress',
                shippingCityLabel: 'Stad',
                shippingZipLabel: 'Postnummer',
                shippingCountryLabel: 'Land',
                continueBtn: 'Forts칛tt till betalning',
                reviewTitle: 'Granska din best칛llning',
                reviewOrderSummary: 'Ordersammanfattning',
                reviewShippingInfo: 'Leveransinformation',
                reviewTotalLabel: 'Totalt:',
                editShippingBtn: 'Redigera',
                payNowBtn: 'Betala nu',
                modalProductAddedTitle: 'Produkt tillagd!',
                modalProductAddedMessage: (productName) => `"${productName}" har lagts till i din varukorg.`,
                modalCannotCheckoutTitle: 'Kan inte g친 till kassan',
                modalCannotCheckoutMessage: 'Din varukorg 칛r tom. L칛gg till varor f칬r att g친 till kassan.',
                modalPaymentSuccessTitle: 'Betalning lyckades!',
                modalPaymentSuccessMessage: (confirmationCode, email) => `<p class="mb-4">Tack f칬r din best칛llning! Din betalning lyckades.</p><p class="mb-4">Din bekr칛ftelsekod 칛r: <span class="font-bold text-teal-600">${confirmationCode}</span></p><p>Ett bekr칛ftelsemail har skickats till ${email}.</p>`,
                modalPaymentFailedTitle: 'Betalning misslyckades',
                modalPaymentFailedMessage: (email) => `<p class="mb-4">Tyv칛rr kunde din betalning inte behandlas.</p><p>Ett mail med ytterligare instruktioner har skickats till ${email}. V칛nligen f칬rs칬k igen eller kontakta support.</p>`,
                modalCartClearedTitle: 'Varukorgen t칬md',
                modalCartClearedMessage: 'Din varukorg har t칬mts.',
                processingBtn: 'Bearbetar...',
                buyNowBtn: 'Betala nu',
                removeItemBtn: 'Ta bort',
                // Category translations
                'nature-inspired-category': '游 Natur-inspirerad',
                'autumn-abstracts-category': '游꼐 H칬stabstrakter',
                'bold-artistic-category': '仇벒잺 Dj칛rv & Konstn칛rlig',
                'shimmer-flow-category': '游꼑 Skimmer & Fl칬de',
                closeBtn: 'St칛ng'
            }
        };
        
        // Product data with categories
        const products = [];
        const categories = [
            { id: 'nature-inspired', nameKey: 'nature-inspired-category', color: 'c9e4c1' }, // Soft pastels
            { id: 'autumn-abstracts', nameKey: 'autumn-abstracts-category', color: 'd28a52' }, // Bold colors
            { id: 'bold-artistic', nameKey: 'bold-artistic-category', color: '4a4a4a' }, // High contrast
            { id: 'shimmer-flow', nameKey: 'shimmer-flow-category', color: 'd4cfd8' } // Marbled, soft blends
        ];

        // Generate 12 products per category, for a total of 48 products
        for (let i = 1; i <= 48; i++) {
            const categoryIndex = (i - 1) % categories.length;
            const category = categories[categoryIndex];
            products.push({
                id: i,
                name: `Product ${i}`,
                category: category.id,
                price: Math.floor(Math.random() * 500) + 100, // Random price between 100 and 600
                imageColor: category.color,
            });
            // Add translations for new products (simple example)
            translations.en[`product${i}Name`] = `Product ${i}`;
            translations.sv[`product${i}Name`] = `Produkt ${i}`;
        }
        
        let currentLang = 'en';

        // Helper function to get product name translation
        function getTranslatedProductName(productId, lang) {
            const product = products.find(p => p.id === productId);
            const productKey = `product${productId}Name`;
            return translations[lang][productKey] || product.name;
        }

        // Function to generate and render product cards
        function renderProducts() {
            const productGroupsElement = document.getElementById('product-groups');
            productGroupsElement.innerHTML = ''; // Clear existing content

            // Group products by category
            const groupedProducts = products.reduce((acc, product) => {
                (acc[product.category] = acc[product.category] || []).push(product);
                return acc;
            }, {});

            categories.forEach(category => {
                const categoryProducts = groupedProducts[category.id] || [];
                if (categoryProducts.length > 0) {
                    const categorySection = document.createElement('div');
                    categorySection.classList.add('mb-12');
                    
                    const categoryTitle = document.createElement('h3');
                    categoryTitle.classList.add('text-xl', 'font-bold', 'text-gray-800', 'mb-4');
                    categoryTitle.textContent = translations[currentLang][category.nameKey];
                    categorySection.appendChild(categoryTitle);

                    const productGrid = document.createElement('div');
                    productGrid.classList.add('grid', 'grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'xl:grid-cols-5', 'gap-6');

                    categoryProducts.forEach(product => {
                        const translatedName = getTranslatedProductName(product.id, currentLang);
                        const imageText = encodeURIComponent(translatedName.replace(/\s/g, '+'));
                        const productImageSrc = `https://placehold.co/300x200/${product.imageColor}/fff?text=${imageText}`;

                        const productCardHtml = `
                            <div class="flex flex-col rounded-lg shadow-md transition-transform duration-200 hover:scale-105 border border-gray-100 p-4">
                                <img src="${productImageSrc}" alt="${translatedName}" class="w-full rounded-lg mb-4">
                                <p class="font-semibold text-lg text-gray-800">${translatedName}</p>
                                <p class="text-teal-600 font-bold text-xl mb-4">${product.price} SEK</p>
                                <button class="add-to-cart-button w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200" data-id="${product.id}" data-lang-key="addToCartBtn">
                                    ${translations[currentLang].addToCartBtn}
                                </button>
                            </div>
                        `;
                        productGrid.innerHTML += productCardHtml;
                    });
                    
                    categorySection.appendChild(productGrid);
                    productGroupsElement.appendChild(categorySection);
                }
            });
        }


        // Global function to handle page switching
        function showPage(pageId) {
            const sections = document.querySelectorAll('section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });

            const pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.classList.remove('hidden');
            }

            // Update active link styling
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            const activeLink = document.querySelector(`[onclick="showPage('${pageId}')"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            // Special rendering for specific pages
            if (pageId === 'products-page') {
                renderProducts();
            } else if (pageId === 'cart-page') {
                renderCart();
            } else if (pageId === 'review-page') {
                renderReview();
            }
        }
        
        // Language setter
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = translations[lang][key];

                if (element.tagName === 'IMG') {
                    // Handle image URL with text
                    const newSrc = `https://placehold.co/800x450/e0f2f7/0e7490?text=${encodeURIComponent(translation)}`;
                    element.src = newSrc;
                    element.alt = translation;
                } else if (typeof translation === 'function') {
                    // This case is for dynamic messages, e.g., in modals
                } else {
                    element.textContent = translation;
                }
            });

            // Re-render cart and review page to update product names if visible
            if (document.getElementById('products-page').classList.contains('hidden') === false) {
                renderProducts();
            }
            if (document.getElementById('cart-page').classList.contains('hidden') === false) {
                renderCart();
            }
            if (document.getElementById('review-page').classList.contains('hidden') === false) {
                renderReview();
            }
        }

        // Get elements for the cart functionality
        const cartCountElement = document.getElementById('cart-count');
        const cartItemsElement = document.getElementById('cart-items');
        const cartTotalElement = document.getElementById('cart-total');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const clearCartButton = document.getElementById('clear-cart-button');
        const checkoutButton = document.getElementById('checkout-button');
        const languageSelector = document.getElementById('language-selector');

        // Function to update the cart counter and total
        function updateCart() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartCountElement.textContent = totalItems;
            cartTotalElement.textContent = totalPrice;
            emptyCartMessage.classList.toggle('hidden', cart.length > 0);
        }

        // Function to render the cart items in the cart page
        function renderCart() {
            cartItemsElement.innerHTML = ''; // Clear existing items
            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
            } else {
                emptyCartMessage.classList.add('hidden');
                cart.forEach(item => {
                    const translatedName = getTranslatedProductName(item.id, currentLang);
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('flex', 'justify-between', 'items-center', 'p-4', 'rounded-lg', 'bg-gray-50');
                    itemElement.innerHTML = `
                        <div class="flex flex-grow items-center space-x-4">
                            <p class="font-semibold text-gray-800">${translatedName}</p>
                            <div class="quantity-control flex items-center space-x-2">
                                <button class="decrease-qty-button" data-id="${item.id}">-</button>
                                <span class="text-sm font-semibold text-gray-700">${item.quantity}</span>
                                <button class="increase-qty-button" data-id="${item.id}">+</button>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <p class="font-bold text-teal-600">${item.price * item.quantity} SEK</p>
                            <button class="remove-from-cart-button text-red-500 hover:text-red-700 font-semibold text-sm transition-colors duration-200" data-id="${item.id}" data-lang-key="removeItemBtn">
                                ${translations[currentLang].removeItemBtn}
                            </button>
                        </div>
                    `;
                    cartItemsElement.appendChild(itemElement);
                });
            }
        }
        
        // Function to render the review page
        function renderReview() {
            const reviewCartItemsElement = document.getElementById('review-cart-items');
            reviewCartItemsElement.innerHTML = ''; // Clear existing items
            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('flex', 'justify-between', 'items-center', 'p-2', 'rounded-lg', 'bg-gray-50');
                const translatedName = getTranslatedProductName(item.id, currentLang);
                itemElement.innerHTML = `
                    <p class="font-semibold text-gray-800">${translatedName} (${item.quantity}x)</p>
                    <p class="font-bold text-teal-600">${item.price * item.quantity} SEK</p>
                `;
                reviewCartItemsElement.appendChild(itemElement);
            });

            const reviewTotalElement = document.getElementById('review-total');
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            reviewTotalElement.textContent = totalPrice;

            const reviewShippingDetailsElement = document.getElementById('review-shipping-details');
            reviewShippingDetailsElement.innerHTML = `
                <p>${shippingInfo.fullName}</p>
                <p>${shippingInfo.emailAddress}</p>
                <p>${shippingInfo.address}</p>
                <p>${shippingInfo.zipCode} ${shippingInfo.city}</p>
                <p>${shippingInfo.country}</p>
            `;
        }
        
        // Helper function to generate a random confirmation code
        function generateConfirmationCode(length = 8) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Function to handle adding a product to the cart
        function handleAddToCartClick(event) {
            const button = event.target;
            const productId = parseInt(button.dataset.id);

            const product = products.find(p => p.id === productId);

            if (!product) {
                return;
            }

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ id: product.id, name: product.name, price: product.price, quantity: 1 });
            }
            updateCart();
            showModal(translations[currentLang].modalProductAddedTitle, translations[currentLang].modalProductAddedMessage(getTranslatedProductName(product.id, currentLang)));
        }

        // Function to remove a single product from the cart
        function handleRemoveItem(event) {
            const button = event.target;
            const productId = parseInt(button.dataset.id);
            const itemIndex = cart.findIndex(item => item.id === productId);

            if (itemIndex > -1) {
                cart.splice(itemIndex, 1);
            }
            updateCart();
            renderCart();
        }
        
        // Function to increase the quantity of a product
        function handleIncreaseQuantity(productId) {
            const item = cart.find(i => i.id === productId);
            if (item) {
                item.quantity++;
                updateCart();
                renderCart();
            }
        }

        // Function to decrease the quantity of a product
        function handleDecreaseQuantity(productId) {
            const item = cart.find(i => i.id === productId);
            if (item) {
                item.quantity--;
                if (item.quantity <= 0) {
                    const itemIndex = cart.findIndex(i => i.id === productId);
                    cart.splice(itemIndex, 1);
                }
                updateCart();
                renderCart();
            }
        }

        // Function to clear the cart
        function handleClearCartClick() {
            cart = [];
            updateCart();
            renderCart();
            showModal(translations[currentLang].modalCartClearedTitle, translations[currentLang].modalCartClearedMessage);
        }

        // Function to handle the checkout process from the cart page
        function handleCartCheckoutClick() {
            if (cart.length === 0) {
                showModal(translations[currentLang].modalCannotCheckoutTitle, translations[currentLang].modalCannotCheckoutMessage);
                return;
            }
            showPage('shipping-page');
        }

        // Function to handle the shipping form submission
        function handleShippingSubmit(event) {
            event.preventDefault();
            const form = event.target;
            if (form.checkValidity()) {
                shippingInfo = {
                    fullName: form.fullName.value,
                    emailAddress: form.emailAddress.value,
                    address: form.address.value,
                    city: form.city.value,
                    zipCode: form.zipCode.value,
                    country: form.country.value,
                };
                showPage('review-page');
            } else {
                // If form is not valid, the browser will show validation errors
                form.reportValidity();
            }
        }

        // Function to handle the final payment from the review page
        function handleFinalCheckoutClick() {
            const payButton = document.getElementById('pay-button');
            payButton.disabled = true;
            payButton.textContent = translations[currentLang].processingBtn;
            payButton.classList.remove('bg-teal-600', 'hover:bg-teal-700');
            payButton.classList.add('bg-teal-400');

            // Simulate a 70% chance of success
            const paymentSuccess = Math.random() < 0.7;

            setTimeout(() => {
                payButton.disabled = false;
                payButton.textContent = translations[currentLang].payNowBtn;
                payButton.classList.remove('bg-teal-400');
                payButton.classList.add('bg-teal-600', 'hover:bg-teal-700');

                if (paymentSuccess) {
                    const confirmationCode = generateConfirmationCode();
                    showModal(
                        translations[currentLang].modalPaymentSuccessTitle,
                        translations[currentLang].modalPaymentSuccessMessage(confirmationCode, shippingInfo.emailAddress)
                    );
                } else {
                    showModal(
                        translations[currentLang].modalPaymentFailedTitle,
                        translations[currentLang].modalPaymentFailedMessage(shippingInfo.emailAddress)
                    );
                }
            }, 2000);
        }
        
        // Get elements for the modal
        const paymentModal = document.getElementById('paymentModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalButton = document.getElementById('closeModalButton');
        const shippingForm = document.getElementById('shipping-form');
        const editShippingButton = document.getElementById('edit-shipping-button');
        const payButton = document.getElementById('pay-button');

        // Global function to show the modal with a custom message
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            paymentModal.classList.remove('hidden');
        }

        // Event listeners
        document.getElementById('products-page').addEventListener('click', (event) => {
            if (event.target.classList.contains('add-to-cart-button')) {
                handleAddToCartClick(event);
            }
        });
        
        // Event delegation for dynamically added buttons in the cart
        document.getElementById('cart-items').addEventListener('click', (event) => {
            const target = event.target;
            const productId = parseInt(target.dataset.id);

            if (target.classList.contains('remove-from-cart-button')) {
                handleRemoveItem(event);
            } else if (target.classList.contains('increase-qty-button')) {
                handleIncreaseQuantity(productId);
            } else if (target.classList.contains('decrease-qty-button')) {
                handleDecreaseQuantity(productId);
            }
        });

        clearCartButton.addEventListener('click', handleClearCartClick);
        // The cart checkout button now navigates to the shipping page
        checkoutButton.addEventListener('click', handleCartCheckoutClick);
        
        // New event listener for the shipping form submission
        shippingForm.addEventListener('submit', handleShippingSubmit);

        // New event listener for editing shipping details
        editShippingButton.addEventListener('click', () => {
            showPage('shipping-page');
        });

        // New event listener for the final payment button
        payButton.addEventListener('click', handleFinalCheckoutClick);

        languageSelector.addEventListener('change', (event) => {
            setLanguage(event.target.value);
        });

        if (closeModalButton) {
            closeModalButton.addEventListener('click', () => {
                paymentModal.classList.add('hidden');
            });
        }

        // Show the initial page on load
        window.onload = () => {
            setLanguage('en'); // Set default language to English
            showPage('products-page');
            updateCart();
        };
    </script>
</body>
</html>
