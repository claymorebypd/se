<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claymore by PD</title>
    <!-- Use Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0fdfa; /* A light teal background */
        }

        /* Style for the active navigation link */
        .nav-link.active {
            font-weight: bold;
            color: #0f766e; /* Darker teal for active link */
            border-bottom: 2px solid #0f766e;
        }

        .quantity-control button {
            @apply bg-gray-200 text-gray-800 font-bold w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200;
        }

        .quantity-control button:hover {
            @apply bg-gray-300;
        }

        /* Styles for the modal dialog */
        .modal {
            @apply fixed inset-0 flex items-center justify-center z-50;
        }

        .modal-overlay {
            @apply fixed inset-0 bg-black bg-opacity-50;
        }

        .modal-content {
            @apply bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 relative;
        }

        /* Animation for page transitions */
        .page {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
        
        input, select, textarea {
            @apply w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500;
        }

        #chat-window {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1.5rem;
            word-wrap: break-word;
        }

        .user-message {
            background-color: #0f766e;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        .bot-message {
            background-color: #e2e8f0;
            color: #1a202c;
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }
    </style>
</head>

<body class="bg-gray-100 font-sans leading-normal tracking-normal">
    <!-- Navigation Bar -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <a href="#" class="text-2xl font-bold text-gray-800" onclick="showPage('products-page')">Claymore by PD</a>

            <div class="flex items-center gap-6">
                <a href="#" class="nav-link text-gray-600 hover:text-gray-800 transition duration-300" onclick="showPage('products-page')" data-lang-key="navProducts">Products</a>
                <a href="#" class="nav-link text-gray-600 hover:text-gray-800 transition duration-300" onclick="showPage('about-us-page')" data-lang-key="navAbout">About Us</a>
                <a href="#" class="nav-link text-gray-600 hover:text-gray-800 transition duration-300" onclick="showPage('contact-us-page')" data-lang-key="navContact">Contact Us</a>
                <button id="admin-button" class="bg-teal-600 text-white font-bold py-1 px-4 rounded-full text-sm hover:bg-teal-700 transition-colors duration-300 hidden" onclick="showPage('admin-page')">Admin</button>

                <div class="relative">
                    <button id="cart-button" class="text-gray-600 hover:text-gray-800 transition duration-300 relative" onclick="showPage('cart-page')">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <span id="cart-count" class="absolute top-0 right-0 -mt-1 -mr-1 bg-red-500 text-white text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center">0</span>
                    </button>
                </div>
            </div>
            <select id="language-selector" class="border rounded-md px-2 py-1 text-sm text-gray-700">
                <option value="en">EN</option>
                <option value="sv">SV</option>
            </select>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto px-6 py-8">
        <!-- Products Page -->
        <section id="products-page" class="page w-full max-w-5xl mx-auto hidden">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-8" data-lang-key="productsTitle">Handmade with Love ❤️</h1>
            <div class="w-full flex justify-center mb-8">
                <img src="https://placehold.co/1024x200/d1fae5/065f46?text=New+Collection+Banner" alt="New Collection Banner" class="rounded-lg shadow-lg w-full">
            </div>
            <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Products will be generated here by JavaScript -->
            </div>
        </section>

        <!-- About Us Page -->
        <section id="about-us-page" class="page w-full max-w-5xl mx-auto hidden">
            <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4" data-lang-key="aboutTitle">About Our Company</h2>
                <p class="text-gray-600 leading-relaxed mb-4" data-lang-key="aboutParagraph1">
                    At Claymore by PD, our passion is crafting unique, wearable art. We believe that jewelry is more than an accessory—it's a form of self-expression. Each piece is meticulously designed and handmade in small batches, ensuring every item is as special as the person who wears it. We focus on creating high-quality, lightweight pieces that add a vibrant, artistic touch to any style.
                </p>
                <p class="text-gray-600 leading-relaxed" data-lang-key="aboutParagraph2">
                    Our collections are inspired by nature, art, and everyday beauty. We use a variety of techniques to shape and cure polymer clay, resulting in diverse textures and stunning color palettes. We are committed to sustainability, using eco-friendly packaging and minimizing waste in our production process. Our goal is to bring a little bit of joy and creativity into your life with every piece we make.
                </p>
            </div>
            <div class="bg-white rounded-lg shadow-xl p-8 flex flex-col md:flex-row items-center md:items-start gap-8">
                <img src="https://placehold.co/192x192" alt="Priyadharshini, the maker of ClayCharm" class="w-48 h-48 rounded-full object-cover shadow-lg flex-shrink-0">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4" data-lang-key="meetTheMakerTitle">Meet the Maker</h3>
                    <p class="text-gray-600 leading-relaxed" data-lang-key="meetTheMakerText">
                        Hi, I’m Priyadharshini [PD], the creator behind Claymore by PD! I started this journey to share my love for crafting and design. Every piece is a reflection of my personal artistic vision, and I pour my heart into creating jewelry that celebrates individuality and beauty. Thank you for supporting a small, handmade business and allowing me to share my passion with you.
                    </p>
                </div>
            </div>
        </section>

        <!-- Contact Us Page -->
        <section id="contact-us-page" class="page w-full max-w-3xl mx-auto hidden">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center" data-lang-key="contactTitle">Get in Touch</h2>
                <div class="text-center mb-6 text-gray-600">
                    <p data-lang-key="contactInfo1">Email: claymorebypd@gmail.com</p>
                    <p data-lang-key="contactInfo2">Instagram: <a href="https://www.instagram.com/claymore_bypd/" target="_blank" class="text-teal-600 hover:underline">@claymore_bypd</a></p>
                </div>
                <form id="contact-form">
                    <div class="mb-4">
                        <label for="contact-name" class="block text-gray-700 font-bold mb-2" data-lang-key="formName">Name</label>
                        <input type="text" id="contact-name" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="contact-email" class="block text-gray-700 font-bold mb-2" data-lang-key="formEmail">Email</label>
                        <input type="email" id="contact-email" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="contact-message" class="block text-gray-700 font-bold mb-2" data-lang-key="formMessage">Message</label>
                        <textarea id="contact-message" rows="4" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500" required></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="contact-feedback" class="block text-gray-700 font-bold mb-2" data-lang-key="formFeedback">Feedback</label>
                        <select id="contact-feedback" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500">
                            <option value="positive" data-lang-key="feedbackPositive">Positive</option>
                            <option value="neutral" data-lang-key="feedbackNeutral">Neutral</option>
                            <option value="negative" data-lang-key="feedbackNegative">Negative</option>
                        </select>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300" data-lang-key="formSubmit">Send Message</button>
                    </div>
                </form>

                <div class="mt-8 border-t pt-8">
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-4">✨ Talk to our Chatbot</h3>
                    <div id="chat-window"></div>
                    <form id="chatbot-form" class="flex mt-4">
                        <input type="text" id="chatbot-input" placeholder="Ask about our products..." class="flex-1 rounded-l-full">
                        <button type="submit" class="bg-teal-600 text-white py-2 px-6 rounded-r-full hover:bg-teal-700 transition-colors duration-300">Send</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Admin Panel Page -->
        <section id="admin-page" class="page w-full max-w-3xl mx-auto hidden">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">Admin Panel</h2>
            <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Add New Product</h3>
                <form id="add-product-form">
                    <div class="mb-4">
                        <label for="product-name" class="block text-gray-700 font-bold mb-2">Product Name</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="mb-4">
                        <label for="product-category" class="block text-gray-700 font-bold mb-2">Category</label>
                        <select id="product-category">
                            <option value="nature">🌿 Nature-Inspired</option>
                            <option value="autumn">🍁 Autumn Abstracts</option>
                            <option value="art">❤️ Bold & Artistic</option>
                            <option value="shimmer">🍂 Shimmer & Flöde</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="product-price" class="block text-gray-700 font-bold mb-2">Price (KR)</label>
                        <input type="number" id="product-price" required>
                    </div>
                    <div class="mb-4">
                        <label for="product-image" class="block text-gray-700 font-bold mb-2">Image URL</label>
                        <input type="url" id="product-image" placeholder="https://placehold.co/400x400" required>
                    </div>
                    <div class="mb-4">
                        <label for="product-description" class="block text-gray-700 font-bold mb-2">Description</label>
                        <textarea id="product-description" rows="4" placeholder="Enter a product description or use the AI generator below." required></textarea>
                        <button type="button" id="generate-description-button" class="mt-2 bg-teal-500 text-white text-sm font-bold py-2 px-4 rounded-full hover:bg-teal-600 transition-colors duration-300">✨ AI Product Description</button>
                    </div>
                    <button type="submit" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300 w-full">Add Product</button>
                </form>
            </div>

            <div class="bg-white rounded-lg shadow-xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Update Product Prices</h3>
                <form id="update-price-form">
                    <div class="mb-4">
                        <label for="update-product-select" class="block text-gray-700 font-bold mb-2">Select Product</label>
                        <select id="update-product-select">
                            <option value="">-- Select a product --</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="new-product-price" class="block text-gray-700 font-bold mb-2">New Price (KR)</label>
                        <input type="number" id="new-product-price" required>
                    </div>
                    <button type="submit" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300 w-full">Update Price</button>
                </form>
            </div>
        </section>

        <!-- Cart Page -->
        <section id="cart-page" class="page w-full max-w-3xl mx-auto hidden">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-8" data-lang-key="cartTitle">Your Shopping Cart</h2>
            <div id="cart-items" class="bg-white rounded-lg shadow-xl p-6 mb-6">
                <p id="empty-cart-message" class="text-center text-gray-500" data-lang-key="cartEmpty">Your cart is empty.</p>
            </div>
            <div id="cart-summary" class="bg-white rounded-lg shadow-xl p-6 mb-6 hidden">
                <div class="flex justify-between items-center text-xl font-bold text-gray-800 mb-4">
                    <span data-lang-key="cartTotal">Total:</span>
                    <span id="cart-total-price">0.00 KR</span>
                </div>
                <div class="flex justify-between gap-4">
                    <button id="clear-cart-button" class="bg-red-500 text-white font-bold py-2 px-6 rounded-full hover:bg-red-600 transition-colors duration-300 flex-1" data-lang-key="cartClear">Clear Cart</button>
                    <button id="checkout-button" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300 flex-1" data-lang-key="cartCheckout">Checkout</button>
                </div>
            </div>
        </section>

        <!-- Shipping Page -->
        <section id="shipping-page" class="page w-full max-w-3xl mx-auto hidden">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-3xl font-bold text-gray-800 text-center mb-6" data-lang-key="shippingTitle">Shipping Information</h2>
                <form id="shipping-form">
                    <div class="mb-4">
                        <label for="full-name" class="block text-gray-700 font-bold mb-2" data-lang-key="formFullName">Full Name</label>
                        <input type="text" id="full-name" required>
                    </div>
                    <div class="mb-4">
                        <label for="shipping-email" class="block text-gray-700 font-bold mb-2" data-lang-key="formEmail">Email</label>
                        <input type="email" id="shipping-email" required>
                    </div>
                    <div class="mb-4">
                        <label for="street-address" class="block text-gray-700 font-bold mb-2" data-lang-key="formStreetAddress">Street Address</label>
                        <input type="text" id="street-address" required>
                    </div>
                    <div class="mb-4">
                        <label for="city" class="block text-gray-700 font-bold mb-2" data-lang-key="formCity">City</label>
                        <input type="text" id="city" required>
                    </div>
                    <div class="mb-4">
                        <label for="zip-code" class="block text-gray-700 font-bold mb-2" data-lang-key="formZipCode">ZIP Code</label>
                        <input type="text" id="zip-code" required>
                    </div>
                    <div class="mb-6">
                        <label for="country" class="block text-gray-700 font-bold mb-2" data-lang-key="formCountry">Country</label>
                        <input type="text" id="country" required>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-full hover:bg-teal-700 transition-colors duration-300" data-lang-key="shippingSubmit">Continue to Review</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Review Page -->
        <section id="review-page" class="page w-full max-w-3xl mx-auto hidden">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-6" data-lang-key="reviewTitle">Review Your Order</h2>
            <div id="review-content" class="bg-white rounded-lg shadow-xl p-8">
                <div class="flex justify-between items-center text-xl font-bold text-gray-800 mb-4">
                    <span data-lang-key="reviewTotal">Total:</span>
                    <span id="review-total-price">0.00 KR</span>
                </div>
                <div class="flex justify-center gap-4 mt-6">
                    <button id="edit-shipping-button" class="bg-gray-400 text-white font-bold py-2 px-6 rounded-full hover:bg-gray-500 transition-colors duration-300" data-lang-key="reviewEdit">Edit</button>
                    <button id="pay-button" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300" data-lang-key="reviewPay">Pay Now</button>
                </div>
            </div>
        </section>

        <!-- Modal for notifications -->
        <div id="payment-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="close-modal-button" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                <div class="text-center">
                    <div id="modal-icon-container" class="mb-4"></div>
                    <h3 id="modal-title" class="text-xl font-bold mb-2 text-gray-800"></h3>
                    <p id="modal-message" class="text-gray-600 mb-4"></p>
                    <button id="modal-close-button" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300" data-lang-key="modalClose">Close</button>
                </div>
            </div>
        </div>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
            import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
            import { getFirestore, doc, addDoc, updateDoc, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

            // Global variables provided by the environment
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);

            let userId;
            let products = [];
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let currentLanguage = 'en';
            let chatHistory = [{
                role: "user",
                parts: [{ text: "You are a friendly and helpful e-commerce chatbot for Claymore by PD. Your purpose is to assist customers with questions about our products. You only have information about the products in the 'products' variable. Do not answer questions outside of this scope. Do not fabricate information. When providing product information, give the name, price, category, and a brief description." }]
            }];
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;

            const IS_ADMIN = true;

            // Language data for translation
            const translations = {
                en: {
                    navProducts: "Products", navAbout: "About Us", navContact: "Contact Us",
                    productsTitle: "Handmade with Love ❤️", productAdd: "Add to Cart",
                    cartTitle: "Your Shopping Cart", cartEmpty: "Your cart is empty.", cartTotal: "Total:",
                    cartClear: "Clear Cart", cartCheckout: "Checkout",
                    aboutTitle: "About Our Company", aboutParagraph1: "At Claymore by PD, our passion is crafting unique, wearable art. We believe that jewelry is more than an accessory—it's a form of self-expression. Each piece is meticulously designed and handmade in small batches, ensuring every item is as special as the person who wears it. We focus on creating high-quality, lightweight pieces that add a vibrant, artistic touch to any style.",
                    aboutParagraph2: "Our collections are inspired by nature, art, and everyday beauty. We use a variety of techniques to shape and cure polymer clay, resulting in diverse textures and stunning color palettes. We are committed to sustainability, using eco-friendly packaging and minimizing waste in our production process. Our goal is to bring a little bit of joy and creativity into your life with every piece we make.",
                    meetTheMakerTitle: "Meet the Maker", meetTheMakerText: "Hi, I’m Priyadharshini [PD], the creator behind Claymore by PD! I started this journey to share my love for crafting and design. Every piece is a reflection of my personal artistic vision, and I pour my heart into creating jewelry that celebrates individuality and beauty. Thank you for supporting a small, handmade business and allowing me to share my passion with you.",
                    contactTitle: "Get in Touch", contactInfo1: "Email: claymorebypd@gmail.com", contactInfo2: "Instagram: @claymore_bypd",
                    formName: "Name", formEmail: "Email", formMessage: "Message", formFeedback: "Feedback",
                    feedbackPositive: "Positive", feedbackNeutral: "Neutral", feedbackNegative: "Negative", formSubmit: "Send Message",
                    shippingTitle: "Shipping Information", formFullName: "Full Name", formStreetAddress: "Street Address",
                    formCity: "City", formZipCode: "ZIP Code", formCountry: "Country", shippingSubmit: "Continue to Review",
                    reviewTitle: "Review Your Order", reviewTotal: "Total:", reviewEdit: "Edit", reviewPay: "Pay Now",
                    modalAddedToCart: "Added to cart!", modalCheckoutSuccess: "Payment Successful!", modalCheckoutSuccessMessage: "Your order has been placed. Confirmation code: ",
                    modalCheckoutFailed: "Payment Failed", modalCheckoutFailedMessage: "There was an issue processing your payment. Please try again later.",
                    modalEmptyCart: "Cart is Empty", modalEmptyCartMessage: "Please add items to your cart before checking out.",
                    modalClearCartSuccess: "Cart Cleared", modalClearCartMessage: "Your shopping cart has been cleared.",
                    modalClose: "Close",
                },
                sv: {
                    navProducts: "Produkter", navAbout: "Om Oss", navContact: "Kontakta Oss",
                    productsTitle: "Handgjort med Kärlek ❤️", productAdd: "Lägg i varukorg",
                    cartTitle: "Din Varukorg", cartEmpty: "Din varukorg är tom.", cartTotal: "Totalt:",
                    cartClear: "Rensa Varukorg", cartCheckout: "Kassa",
                    aboutTitle: "Om vårt företag", aboutParagraph1: "På Claymore by PD är vår passion att skapa unika, bärbara konstverk. Vi anser att smycken är mer än en accessoar – det är ett sätt att uttrycka dig själv. Varje smycke är noggrant designat och handgjort i små partier, vilket säkerställer att varje föremål är lika speciellt som personen som bär det. Vi fokuserar på att skapa högkvalitativa, lätta smycken som ger en livlig, konstnärlig touch till alla stilar.",
                    aboutParagraph2: "Våra kollektioner är inspirerade av naturen, konst och vardaglig skönhet. Vi använder en mängd olika tekniker för att forma och härda polymerlera, vilket resulterar i olika texturer och fantastiska färgpaletter. Vi är engagerade i hållbarhet, använder miljövänliga förpackningar och minimerar avfall i vår produktionsprocess. Vårt mål är att ge lite glädje och kreativitet i ditt liv med varje smycke vi skapar.",
                    meetTheMakerTitle: "Möt skaparen", meetTheMakerText: "Hej, jag är Priyadharshini [PD], skaparen bakom Claymore by PD! Jag började den här resan för att dela min kärlek till hantverk och design. Varje smycke är en återspegling av min personliga konstnärliga vision, och jag lägger hela mitt hjärta i att skapa smycken som hyllar individualitet och skönhet. Tack för att du stöder ett litet, handgjort företag och låter mig dela min passion med dig.",
                    contactTitle: "Kontakta Oss", contactInfo1: "E-post: claymorebypd@gmail.com", contactInfo2: "Instagram: @claymore_bypd",
                    formName: "Namn", formEmail: "E-post", formMessage: "Meddelande", formFeedback: "Återkoppling",
                    feedbackPositive: "Positivt", feedbackNeutral: "Neutralt", feedbackNegative: "Negativt", formSubmit: "Skicka Meddelande",
                    shippingTitle: "Fraktinformation", formFullName: "Fullständigt namn", formStreetAddress: "Gatuadress",
                    formCity: "Stad", formZipCode: "Postnummer", formCountry: "Land", shippingSubmit: "Fortsätt till granskning",
                    reviewTitle: "Granska din beställning", reviewTotal: "Totalt:", reviewEdit: "Redigera", reviewPay: "Betala nu",
                    modalAddedToCart: "Tillagd i varukorgen!", modalCheckoutSuccess: "Betalning lyckades!", modalCheckoutSuccessMessage: "Din beställning har gjorts. Bekräftelsekod: ",
                    modalCheckoutFailed: "Betalning misslyckades", modalCheckoutFailedMessage: "Det uppstod ett problem med din betalning. Vänligen försök igen senare.",
                    modalEmptyCart: "Varukorgen är tom", modalEmptyCartMessage: "Vänligen lägg till varor i din varukorg innan du går till kassan.",
                    modalClearCartSuccess: "Varukorgen rensad", modalClearCartMessage: "Din varukorg har rensats.",
                    modalClose: "Stäng",
                }
            };

            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('.nav-link');
            const productList = document.getElementById('product-list');
            const cartItemsContainer = document.getElementById('cart-items');
            const cartCountSpan = document.getElementById('cart-count');
            const cartTotalSpan = document.getElementById('cart-total-price');
            const reviewTotalSpan = document.getElementById('review-total-price');
            const cartSummaryDiv = document.getElementById('cart-summary');
            const clearCartButton = document.getElementById('clear-cart-button');
            const checkoutButton = document.getElementById('checkout-button');
            const shippingForm = document.getElementById('shipping-form');
            const reviewContentDiv = document.getElementById('review-content');
            const paymentModal = document.getElementById('payment-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalIconContainer = document.getElementById('modal-icon-container');
            const modalCloseButton = document.getElementById('modal-close-button');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const languageSelector = document.getElementById('language-selector');
            const adminButton = document.getElementById('admin-button');
            const addProductForm = document.getElementById('add-product-form');
            const updatePriceForm = document.getElementById('update-price-form');
            const updateProductSelect = document.getElementById('update-product-select');
            const generateDescriptionButton = document.getElementById('generate-description-button');
            const productDescriptionTextarea = document.getElementById('product-description');
            const chatbotForm = document.getElementById('chatbot-form');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatWindow = document.getElementById('chat-window');

            function showPage(pageId) {
                pages.forEach(page => page.classList.add('hidden'));
                document.getElementById(pageId).classList.remove('hidden');
                navLinks.forEach(link => link.classList.remove('active'));
                const activeLink = document.querySelector(`[onclick="showPage('${pageId}')"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }

            window.showPage = showPage;

            function setLanguage(lang) {
                currentLanguage = lang;
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.getAttribute('data-lang-key');
                    if (translations[lang] && translations[lang][key]) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = translations[lang][key];
                        } else if (element.tagName === 'BUTTON') {
                            element.textContent = translations[lang][key];
                        } else {
                            element.textContent = translations[lang][key];
                        }
                    }
                });
                updateCart();
                renderProducts(products);
                renderUpdateProductOptions();
            }

            function renderProducts(productsData) {
                productList.innerHTML = '';
                const groupedProducts = productsData.reduce((acc, product) => {
                    const category = product.category || 'other';
                    if (!acc[category]) {
                        acc[category] = [];
                    }
                    acc[category].push(product);
                    return acc;
                }, {});

                for (const category in groupedProducts) {
                    const categorySection = document.createElement('div');
                    categorySection.className = 'w-full mb-8';

                    const categoryTitle = document.createElement('h3');
                    let categoryName = '';
                    switch (category) {
                        case 'nature':
                            categoryName = '🌿 Nature-Inspired';
                            break;
                        case 'autumn':
                            categoryName = '🍁 Autumn Abstracts';
                            break;
                        case 'art':
                            categoryName = '❤️ Bold & Artistic';
                            break;
                        case 'shimmer':
                            categoryName = '🍂 Shimmer & Flöde';
                            break;
                        default:
                            categoryName = category;
                    }

                    categoryTitle.className = 'text-2xl font-bold text-gray-800 mb-6 border-b-2 border-teal-500 pb-2';
                    categoryTitle.textContent = categoryName;
                    categorySection.appendChild(categoryTitle);

                    const productGrid = document.createElement('div');
                    productGrid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6';

                    groupedProducts[category].forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'bg-white rounded-xl shadow-lg overflow-hidden transform transition-transform duration-300 hover:scale-105 hover:shadow-2xl';
                        productCard.innerHTML = `
                            <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
                            <div class="p-4 text-center">
                                <h3 class="text-lg font-semibold text-gray-800 mb-1">${product.name}</h3>
                                <p class="text-gray-600 text-sm mb-2">${product.description || 'No description available.'}</p>
                                <p class="text-teal-600 font-bold mb-4">${product.price} KR</p>
                                <button onclick="addToCart('${product.id}')" class="add-to-cart-button bg-teal-500 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-600 transition-colors duration-300" data-lang-key="productAdd">${translations[currentLanguage].productAdd}</button>
                            </div>
                        `;
                        productGrid.appendChild(productCard);
                    });
                    categorySection.appendChild(productGrid);
                    productList.appendChild(categorySection);
                }
            }

            function addToCart(productId) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    const existingItem = cart.find(item => item.id === productId);
                    if (existingItem) {
                        existingItem.quantity++;
                    } else {
                        cart.push({ ...product, quantity: 1 });
                    }
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCart();
                    showModal('modalAddedToCart', 'modalAddedToCart');
                }
            }

            window.addToCart = addToCart;

            function updateCart() {
                cartCountSpan.textContent = cart.reduce((total, item) => total + item.quantity, 0);
                renderCartItems();
            }

            function renderCartItems() {
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsContainer.appendChild(emptyCartMessage);
                    emptyCartMessage.classList.remove('hidden');
                    cartSummaryDiv.classList.add('hidden');
                } else {
                    emptyCartMessage.classList.add('hidden');
                    cartSummaryDiv.classList.remove('hidden');

                    cart.forEach(item => {
                        const cartItem = document.createElement('div');
                        cartItem.className = 'flex items-center justify-between py-4 border-b last:border-b-0';
                        cartItem.innerHTML = `
                            <div class="flex items-center gap-4">
                                <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded-lg object-cover">
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-800">${item.name}</h4>
                                    <p class="text-teal-600 font-bold">${item.price} KR</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="flex items-center space-x-2 quantity-control" data-product-id="${item.id}">
                                    <button class="decrease-qty-button">-</button>
                                    <span class="quantity text-lg font-semibold">${item.quantity}</span>
                                    <button class="increase-qty-button">+</button>
                                </div>
                                <button class="remove-from-cart-button text-red-500 hover:text-red-700 transition-colors duration-300" data-product-id="${item.id}">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        `;
                        cartItemsContainer.appendChild(cartItem);
                    });
                    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                    cartTotalSpan.textContent = `${total} KR`;
                }
            }

            function handleRemoveFromCart(productId) {
                cart = cart.filter(item => item.id !== productId);
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCart();
            }

            function handleIncreaseQuantity(productId) {
                const item = cart.find(item => item.id === productId);
                if (item) {
                    item.quantity++;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCart();
                }
            }

            function handleDecreaseQuantity(productId) {
                const item = cart.find(item => item.id === productId);
                if (item && item.quantity > 1) {
                    item.quantity--;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCart();
                } else if (item && item.quantity === 1) {
                    handleRemoveFromCart(productId);
                }
            }

            function showModal(titleKey, messageKey, iconName = 'info') {
                modalTitle.textContent = translations[currentLanguage][titleKey];
                modalMessage.textContent = translations[currentLanguage][messageKey];
                modalIconContainer.innerHTML = getModalIcon(iconName);
                paymentModal.classList.remove('hidden');
            }

            function getModalIcon(iconName) {
                switch (iconName) {
                    case 'success':
                        return `<svg class="w-16 h-16 text-green-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                    case 'error':
                        return `<svg class="w-16 h-16 text-red-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                    case 'warning':
                        return `<svg class="w-16 h-16 text-yellow-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856a2 2 0 001.789-2.895L13.789 4.105a2 2 0 00-3.578 0L3.341 16.105A2 2 0 005.13 19z"></path></svg>`;
                    default:
                        return `<svg class="w-16 h-16 text-gray-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                }
            }

            function handleClearCartClick() {
                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCart();
                showModal('modalClearCartSuccess', 'modalClearCartMessage', 'success');
            }

            function handleCartCheckoutClick() {
                if (cart.length === 0) {
                    showModal('modalEmptyCart', 'modalEmptyCartMessage', 'warning');
                } else {
                    showPage('shipping-page');
                }
            }

            function handleShippingSubmit(event) {
                event.preventDefault();
                const shippingDetails = {
                    fullName: document.getElementById('full-name').value,
                    email: document.getElementById('shipping-email').value,
                    streetAddress: document.getElementById('street-address').value,
                    city: document.getElementById('city').value,
                    zipCode: document.getElementById('zip-code').value,
                    country: document.getElementById('country').value,
                };
                localStorage.setItem('shippingDetails', JSON.stringify(shippingDetails));
                renderReviewPage();
                showPage('review-page');
            }

            function renderReviewPage() {
                const shippingDetails = JSON.parse(localStorage.getItem('shippingDetails'));
                const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

                let orderSummaryHtml = `<h3 class="text-xl font-bold text-gray-800 mb-4" data-lang-key="cartTitle">Your Shopping Cart</h3><div class="border rounded-lg p-4 mb-6">`;
                cart.forEach(item => {
                    orderSummaryHtml += `<div class="flex justify-between py-2"><span>${item.name} (x${item.quantity})</span><span>${item.price * item.quantity} KR</span></div>`;
                });
                orderSummaryHtml += `</div>`;

                let shippingSummaryHtml = `<h3 class="text-xl font-bold text-gray-800 mb-4" data-lang-key="shippingTitle">Shipping Information</h3><div class="border rounded-lg p-4 mb-6"><p><strong>${translations[currentLanguage].formFullName}:</strong> ${shippingDetails.fullName}</p><p><strong>${translations[currentLanguage].formEmail}:</strong> ${shippingDetails.email}</p><p><strong>${translations[currentLanguage].formStreetAddress}:</strong> ${shippingDetails.streetAddress}</p><p><strong>${translations[currentLanguage].formCity}:</strong> ${shippingDetails.city}</p><p><strong>${translations[currentLanguage].formZipCode}:</strong> ${shippingDetails.zipCode}</p><p><strong>${translations[currentLanguage].formCountry}:</strong> ${shippingDetails.country}</p></div>`;

                reviewContentDiv.innerHTML = orderSummaryHtml + shippingSummaryHtml + `
                    <div class="flex justify-between items-center text-xl font-bold text-gray-800 mb-4">
                        <span data-lang-key="reviewTotal">${translations[currentLanguage].reviewTotal}</span>
                        <span id="review-total-price">${total} KR</span>
                    </div>
                    <div class="flex justify-center gap-4 mt-6">
                        <button id="edit-shipping-button" class="bg-gray-400 text-white font-bold py-2 px-6 rounded-full hover:bg-gray-500 transition-colors duration-300" data-lang-key="reviewEdit">${translations[currentLanguage].reviewEdit}</button>
                        <button id="pay-button" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300" data-lang-key="reviewPay">${translations[currentLanguage].reviewPay}</button>
                    </div>
                `;
                document.getElementById('edit-shipping-button').addEventListener('click', () => showPage('shipping-page'));
                document.getElementById('pay-button').addEventListener('click', handleFinalCheckoutClick);
            }

            function handleFinalCheckoutClick() {
                const isPaymentSuccessful = Math.random() < 0.7;
                if (isPaymentSuccessful) {
                    const confirmationCode = 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCart();
                    showModal('modalCheckoutSuccess', 'modalCheckoutSuccessMessage' + confirmationCode, 'success');
                } else {
                    showModal('modalCheckoutFailed', 'modalCheckoutFailedMessage', 'error');
                }
            }

            async function handleAddProductForm(event) {
                event.preventDefault();
                const name = document.getElementById('product-name').value;
                const category = document.getElementById('product-category').value;
                const price = parseFloat(document.getElementById('product-price').value);
                const image = document.getElementById('product-image').value;
                const description = document.getElementById('product-description').value;

                try {
                    await addDoc(collection(db, `/artifacts/${appId}/public/data/products`), {
                        name,
                        category,
                        price,
                        image,
                        description
                    });
                    showModal('modalAddedToCart', 'Product added successfully!', 'success');
                    addProductForm.reset();
                } catch (e) {
                    showModal('modalCheckoutFailed', `Error adding document: ${e}`, 'error');
                }
            }

            async function handleUpdatePriceForm(event) {
                event.preventDefault();
                const productId = updateProductSelect.value;
                const newPrice = parseFloat(document.getElementById('new-product-price').value);

                if (!productId) {
                    showModal('modalCheckoutFailed', 'Please select a product to update.', 'warning');
                    return;
                }

                try {
                    const productDocRef = doc(db, `/artifacts/${appId}/public/data/products`, productId);
                    await updateDoc(productDocRef, {
                        price: newPrice
                    });
                    showModal('modalAddedToCart', 'Product price updated successfully!', 'success');
                } catch (e) {
                    showModal('modalCheckoutFailed', `Error updating document: ${e}`, 'error');
                }
            }

            function renderUpdateProductOptions() {
                updateProductSelect.innerHTML = '<option value="">-- Select a product --</option>';
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} (${product.price} KR)`;
                    updateProductSelect.appendChild(option);
                });
            }

            function appendMessage(sender, message) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
                messageElement.textContent = message;
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            async function generateDescription(productName, productCategory) {
                const systemPrompt = `You are a creative copywriter for a handmade jewelry store called Claymore by PD. Write a concise and engaging product description (2-3 sentences) for a piece of jewelry. The jewelry is made from polymer clay. Mention the style based on the category.`;
                const userQuery = `Write a product description for an item named "${productName}" in the category "${productCategory}".`;

                const payload = {
                    contents: [{
                        parts: [{
                            text: userQuery
                        }]
                    }],
                    systemInstruction: {
                        parts: [{
                            text: systemPrompt
                        }]
                    },
                    generationConfig: {
                        responseMimeType: "text/plain"
                    }
                };

                const apiKey = "";
                const apiUrl = `${API_URL}${apiKey}`;
                const loadingMessage = "Generating description...";
                productDescriptionTextarea.value = loadingMessage;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const description = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (description) {
                        productDescriptionTextarea.value = description;
                    } else {
                        productDescriptionTextarea.value = 'Failed to generate description.';
                    }
                } catch (error) {
                    console.error("Error generating description:", error);
                    productDescriptionTextarea.value = 'Error generating description.';
                }
            }

            async function handleChatbotSubmit(event) {
                event.preventDefault();
                const userMessage = chatbotInput.value.trim();
                if (!userMessage) return;

                appendMessage('user', userMessage);
                chatbotInput.value = '';
                appendMessage('bot', 'Typing...');

                const productDataForLLM = products.map(p => ({
                    name: p.name,
                    category: p.category,
                    price: p.price,
                    description: p.description
                }));
                const productInfoPrompt = `Available products: ${JSON.stringify(productDataForLLM)}.`;

                chatHistory.push({
                    role: "user",
                    parts: [{
                        text: productInfoPrompt + "\n\n" + userMessage
                    }]
                });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "text/plain"
                    }
                };
                const apiKey = "";
                const apiUrl = `${API_URL}${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const botResponse = result?.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I can't answer that question.";

                    chatHistory.push({
                        role: "model",
                        parts: [{
                            text: botResponse
                        }]
                    });
                    chatWindow.lastChild.textContent = botResponse; // Replace 'Typing...' message
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                } catch (error) {
                    console.error("Error with chatbot API:", error);
                    chatWindow.lastChild.textContent = "Sorry, an error occurred. Please try again later.";
                }
            }

            // Event Listeners
            productList.addEventListener('click', (event) => {
                const button = event.target.closest('.add-to-cart-button');
                if (button) {
                    const productId = button.getAttribute('onclick').match(/'([^']+)'/)[1];
                    addToCart(productId);
                }
            });
            cartItemsContainer.addEventListener('click', (event) => {
                const target = event.target;
                const productId = target.closest('[data-product-id]')?.dataset.productId;
                if (!productId) return;
                if (target.classList.contains('remove-from-cart-button') || target.closest('.remove-from-cart-button')) {
                    handleRemoveFromCart(productId);
                } else if (target.classList.contains('increase-qty-button')) {
                    handleIncreaseQuantity(productId);
                } else if (target.classList.contains('decrease-qty-button')) {
                    handleDecreaseQuantity(productId);
                }
            });
            clearCartButton.addEventListener('click', handleClearCartClick);
            checkoutButton.addEventListener('click', handleCartCheckoutClick);
            shippingForm.addEventListener('submit', handleShippingSubmit);
            modalCloseButton.addEventListener('click', () => paymentModal.classList.add('hidden'));
            languageSelector.addEventListener('change', (event) => setLanguage(event.target.value));
            if (addProductForm) addProductForm.addEventListener('submit', handleAddProductForm);
            if (updatePriceForm) updatePriceForm.addEventListener('submit', handleUpdatePriceForm);
            if (generateDescriptionButton) {
                generateDescriptionButton.addEventListener('click', () => {
                    const productName = document.getElementById('product-name').value;
                    const productCategory = document.getElementById('product-category').value;
                    if (productName && productCategory) {
                        generateDescription(productName, productCategory);
                    } else {
                        showModal('modalCheckoutFailed', 'Please enter a product name and select a category first.', 'warning');
                    }
                });
            }
            if (chatbotForm) chatbotForm.addEventListener('submit', handleChatbotSubmit);

            // Initial setup
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    if (IS_ADMIN) {
                        adminButton.classList.remove('hidden');
                    }
                    const q = query(collection(db, `/artifacts/${appId}/public/data/products`));
                    onSnapshot(q, (querySnapshot) => {
                        products = [];
                        querySnapshot.forEach((doc) => {
                            products.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        renderProducts(products);
                        renderUpdateProductOptions();
                    });
                } else {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                }
            });

            window.onload = () => {
                setLanguage('en');
                showPage('products-page');
                updateCart();
                // Attach event listeners for the new review page buttons
                const editShippingButton = document.getElementById('edit-shipping-button');
                if (editShippingButton) {
                    editShippingButton.addEventListener('click', () => showPage('shipping-page'));
                }
                const payButton = document.getElementById('pay-button');
                if (payButton) {
                    payButton.addEventListener('click', handleFinalCheckoutClick);
                }
            };
        </script>
</body>
</html>
